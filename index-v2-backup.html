<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Station & C-Store Opening Alerts Feed - LIVE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .search-queries, .rss-feeds-section {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-queries h3, .rss-feeds-section h3 {
            color: #333;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-icon {
            font-size: 0.8em;
            transition: transform 0.3s;
        }

        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        .query-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }

        .query-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #4b5563;
            border: 1px solid #e5e7eb;
        }

        .rss-feed-item {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #6b7280;
            border: 1px solid #e5e7eb;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        .feed-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            flex-wrap: wrap;
            gap: 15px;
        }

        .feed-title {
            font-size: 1.5em;
            color: #333;
        }

        .filter-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex: 1;
            max-width: 400px;
        }

        .filter-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9em;
            outline: none;
            transition: border-color 0.3s;
        }

        .filter-input:focus {
            border-color: #667eea;
        }

        .clear-filter-btn {
            padding: 10px 15px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .clear-filter-btn:hover {
            background: #dc2626;
        }

        .filter-stats {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 15px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .live-indicator.loading {
            background: #fbbf24;
            color: #78350f;
        }

        .live-indicator.live {
            background: #10b981;
            color: white;
        }

        .live-indicator.waiting {
            background: #94a3b8;
            color: white;
        }

        .pulse {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .alert-item {
            background: #f9fafb;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            animation: slideIn 0.5s ease-out;
            transition: opacity 0.3s;
        }

        .alert-item.filtered-out {
            display: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .alert-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }

        .alert-time {
            font-size: 0.85em;
            color: #6b7280;
            white-space: nowrap;
            margin-left: 15px;
        }

        .alert-source {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .alert-snippet {
            color: #4b5563;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .no-alerts {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚õΩ Gas Station & C-Store Opening Alerts</h1>
            <p class="subtitle">Real-time monitoring of new gas stations, convenience stores, and fuel centers</p>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalAlerts">29</div>
                    <div class="stat-label">Active RSS Feeds</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayCount">0</div>
                    <div class="stat-label">Alerts Loaded</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="backendStatus">üü°</div>
                    <div class="stat-label">Server Status</div>
                </div>
            </div>
        </header>

        <div class="search-queries">
            <h3 onclick="toggleSection('queries')">
                <span class="toggle-icon" id="queries-icon">‚ñº</span>
                üîç Gas Station Search Queries (10)
            </h3>
            <div class="collapsible-content" id="queries-content">
                <div class="query-grid">
                    <div class="query-item">"new gas station" "opening soon"</div>
                    <div class="query-item">"convenience store" "fuel pumps" "coming soon"</div>
                    <div class="query-item">"travel center" "new construction"</div>
                    <div class="query-item">"fuel station" "permit approved"</div>
                    <div class="query-item">"service station" "new development"</div>
                    <div class="query-item">"filling station" "coming soon"</div>
                    <div class="query-item">"c-store" "fuel" "new location"</div>
                    <div class="query-item">"truck stop" "new construction"</div>
                    <div class="query-item">"gas bar" "opening"</div>
                    <div class="query-item">"convenience mart" "gas pumps" "new"</div>
                </div>
            </div>
        </div>

        <div class="rss-feeds-section">
            <h3 onclick="toggleSection('rss')">
                <span class="toggle-icon" id="rss-icon">‚ñº</span>
                üì° Active RSS Feeds (29) - Gas Stations Only
            </h3>
            <div class="collapsible-content" id="rss-content">
                <div class="query-grid" id="rssFeedsList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="feed-container">
            <div class="feed-header">
                <div class="feed-title">üì∞ Live Feed</div>
                <div class="filter-container">
                    <input
                        type="text"
                        class="filter-input"
                        id="filterInput"
                        placeholder="üîç Filter alerts by keyword..."
                        onkeyup="filterAlerts()"
                    >
                    <button class="clear-filter-btn" onclick="clearFilter()">‚úï</button>
                </div>
                <div class="live-indicator loading" id="liveIndicator">
                    <div class="pulse"></div>
                    <span id="statusText">CONNECTING</span>
                </div>
            </div>

            <div class="filter-stats" id="filterStats" style="display: none;"></div>

            <div id="alertsFeed">
                <div class="no-alerts">
                    <p>Connecting to backend server...</p>
                    <p style="font-size: 0.9em; margin-top: 10px;">Fetching RSS feeds from Google Alerts...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Backend configuration
        const BACKEND_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://gas-station-alerts-backend-1.onrender.com';
        const API_URL = `${BACKEND_URL}/api/feeds`;

        // RSS Feed URLs - Gas Station Alerts Only
        const RSS_FEEDS = [
            'https://www.google.com/alerts/feeds/09182428279069180430/2356736684601183531',
            'https://www.google.com/alerts/feeds/09182428279069180430/10272491932958314872',
            'https://www.google.com/alerts/feeds/09182428279069180430/18098273169971572213',
            'https://www.google.com/alerts/feeds/09182428279069180430/7464813959798405035',
            'https://www.google.com/alerts/feeds/09182428279069180430/17182240907846120717',
            'https://www.google.com/alerts/feeds/09182428279069180430/1226120987289009438',
            'https://www.google.com/alerts/feeds/09182428279069180430/3328131774048131868',
            'https://www.google.com/alerts/feeds/09182428279069180430/2641101500755475746',
            'https://www.google.com/alerts/feeds/09182428279069180430/2665165367342573063',
            'https://www.google.com/alerts/feeds/09182428279069180430/1856006892992916883',
            'https://www.google.com/alerts/feeds/09182428279069180430/11760473391334443585',
            'https://www.google.com/alerts/feeds/09182428279069180430/16754394224087368820',
            'https://www.google.com/alerts/feeds/09182428279069180430/805090456831878584',
            'https://www.google.com/alerts/feeds/09182428279069180430/2356736684601182860',
            'https://www.google.com/alerts/feeds/09182428279069180430/11561908779301281246',
            'https://www.google.com/alerts/feeds/09182428279069180430/2862118317250464279',
            'https://www.google.com/alerts/feeds/09182428279069180430/7125003852991128726',
            'https://www.google.com/alerts/feeds/09182428279069180430/8854767764924737815',
            'https://www.google.com/alerts/feeds/09182428279069180430/2214701372282077850',
            'https://www.google.com/alerts/feeds/09182428279069180430/15967401914306998170',
            'https://www.google.com/alerts/feeds/09182428279069180430/18098273169971569420',
            'https://www.google.com/alerts/feeds/09182428279069180430/6030688961984603201',
            'https://www.google.com/alerts/feeds/09182428279069180430/13923193800938194260',
            'https://www.google.com/alerts/feeds/09182428279069180430/10812523901845474331',
            'https://www.google.com/alerts/feeds/09182428279069180430/17386860109803368591',
            'https://www.google.com/alerts/feeds/09182428279069180430/14009841047842724740',
            'https://www.google.com/alerts/feeds/09182428279069180430/3546512814188894202',
            'https://www.google.com/alerts/feeds/09182428279069180430/805090456831878167',
            'https://www.google.com/alerts/feeds/09182428279069180430/1226120987289009546'
        ];

        let alertCount = 0;
        let lastFetchTime = null;
        let allAlerts = [];

        // Populate RSS feeds list
        // Alert names corresponding to RSS feeds
        const ALERT_NAMES = [
            '"c-store" "fuel" "new location"',
            '"c-store" "fuel" construction (excluding major chains)',
            '"convenience mart" "fuel" opening (excluding major chains)',
            '"convenience mart" "gas pumps" "new"',
            '"convenience store" "fuel pumps" "coming soon"',
            '"convenience store" "fuel pumps" permit (excluding major chains)',
            '"filling station" "coming soon"',
            '"filling station" opening (excluding major chains)',
            '"fuel center" construction (excluding major chains)',
            '"fuel mart" new (excluding major chains)',
            '"fuel station" "permit approved"',
            '"fuel station" permit (excluding major chains)',
            '"fuel stop" new (excluding major chains)',
            '"gas bar" "opening"',
            '"gas bar" construction (excluding major chains)',
            '"gas station construction" (excluding major chains)',
            '"gas station" "breaking ground" (excluding major chains)',
            '"gas station" "coming soon" (excluding major chains)',
            '"gas station" "grand opening" (excluding major chains)',
            '"gas station" "land use" (excluding major chains)',
            '"gas station" "now open" (excluding major chains)',
            '"gas station" "ribbon cutting" (excluding major chains)',
            '"gas station" "site plan" (excluding major chains)',
            '"gas station" approved (excluding major chains)',
            '"gas station" proposal (excluding major chains)',
            '"gas station" zoning (excluding major chains)',
            '"independent gas station" new (excluding major chains)',
            '"new gas station" "opening soon"',
            '"new gas station" opening (excluding major chains)',
            '"petrol station" new (excluding major chains)',
            '"service station" "new development"',
            '"service station" development (excluding major chains)',
            '"travel center" "new construction"',
            '"truck stop" "new construction"'
        ];

        function populateRSSFeeds() {
            const container = document.getElementById('rssFeedsList');
            // Only show the first 29 entries that match our actual feeds
            ALERT_NAMES.slice(0, 29).forEach((name, index) => {
                const div = document.createElement('div');
                div.className = 'query-item'; // Use same styling as search queries
                div.textContent = name;
                container.appendChild(div);
            });
        }

        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const icon = document.getElementById(`${sectionId}-icon`);

            content.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }

        // Filter alerts
        function filterAlerts() {
            const filterValue = document.getElementById('filterInput').value.toLowerCase();
            const alerts = document.querySelectorAll('.alert-item');
            const filterStats = document.getElementById('filterStats');

            let visibleCount = 0;

            alerts.forEach(alert => {
                const text = alert.textContent.toLowerCase();
                if (text.includes(filterValue)) {
                    alert.classList.remove('filtered-out');
                    visibleCount++;
                } else {
                    alert.classList.add('filtered-out');
                }
            });

            if (filterValue) {
                filterStats.style.display = 'block';
                filterStats.textContent = `Showing ${visibleCount} of ${alerts.length} alerts matching "${filterValue}"`;
            } else {
                filterStats.style.display = 'none';
            }
        }

        // Clear filter
        function clearFilter() {
            document.getElementById('filterInput').value = '';
            filterAlerts();
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        function updateLiveIndicator(status, text) {
            const indicator = document.getElementById('liveIndicator');
            const statusText = document.getElementById('statusText');

            indicator.className = `live-indicator ${status}`;
            statusText.textContent = text;
        }

        function updateBackendStatus(status) {
            const statusEl = document.getElementById('backendStatus');
            if (status === 'online') {
                statusEl.textContent = 'üü¢';
            } else if (status === 'loading') {
                statusEl.textContent = 'üü°';
            } else {
                statusEl.textContent = 'üî¥';
            }
        }

        function addAlertToFeed(alert) {
            const feed = document.getElementById('alertsFeed');

            // Remove "no alerts" message
            const noAlerts = feed.querySelector('.no-alerts');
            if (noAlerts) {
                noAlerts.remove();
            }

            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert-item';
            const alertLink = alert.link || alert.guid || '#';
            const alertTitle = alert.title || 'Untitled Alert';

            alertDiv.innerHTML = `
                <div class="alert-header">
                    <div class="alert-title">
                        <a href="${alertLink}" target="_blank" rel="noopener noreferrer" style="color: #1f2937; text-decoration: none; display: block; transition: color 0.3s;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#1f2937'">
                            ${alertTitle}
                        </a>
                    </div>
                    <div class="alert-time">${formatTime(alert.pubDate || alert.isoDate || new Date())}</div>
                </div>
                <div class="alert-source">üì∞ ${alert.source || 'Google Alerts'}</div>
                <div class="alert-snippet">${alert.contentSnippet || alert.content || 'No description available'}</div>
            `;

            feed.insertBefore(alertDiv, feed.firstChild);
            allAlerts.push(alert);
            alertCount++;
            document.getElementById('todayCount').textContent = alertCount;
        }

        async function fetchRSSFeeds() {
            try {
                console.log('Fetching RSS feeds from:', API_URL);
                updateLiveIndicator('loading', 'LOADING');
                updateBackendStatus('loading');

                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Received data:', data);

                if (data.success && data.items && data.items.length > 0) {
                    updateLiveIndicator('live', 'LIVE');
                    updateBackendStatus('online');

                    data.items.forEach(item => {
                        addAlertToFeed(item);
                    });

                    lastFetchTime = new Date();
                } else {
                    updateLiveIndicator('waiting', 'WAITING');
                    updateBackendStatus('online');
                    console.log('No items in response');
                }
            } catch (error) {
                console.error('Error fetching RSS feeds:', error);
                updateLiveIndicator('waiting', 'ERROR');
                updateBackendStatus('offline');

                const feed = document.getElementById('alertsFeed');
                if (feed.children.length === 0) {
                    feed.innerHTML = `
                        <div class="no-alerts">
                            <p>Could not connect to backend server</p>
                            <p style="font-size: 0.9em; margin-top: 10px;">Error: ${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            populateRSSFeeds();
            fetchRSSFeeds();

            // Refresh every 5 minutes
            setInterval(fetchRSSFeeds, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
