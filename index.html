<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Station & C-Store Opening Alerts Feed - LIVE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .alert-banner {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
        }

        .alert-banner h3 {
            color: #92400e;
            margin-bottom: 8px;
        }

        .alert-banner p {
            color: #78350f;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .feed-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 700px;
            overflow-y: auto;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .feed-title {
            font-size: 1.5em;
            color: #333;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #10b981;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .live-indicator.loading {
            background: #6b7280;
        }

        .live-indicator.error {
            background: #ef4444;
        }

        .pulse {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .alert-item {
            background: #f9fafb;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-item.new {
            border-left-color: #10b981;
            background: #ecfdf5;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .alert-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }

        .alert-title a {
            color: #1f2937;
            text-decoration: none;
        }

        .alert-title a:hover {
            color: #667eea;
        }

        .alert-time {
            font-size: 0.85em;
            color: #6b7280;
            white-space: nowrap;
            margin-left: 15px;
        }

        .alert-source {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .alert-snippet {
            color: #4b5563;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .alert-tags {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .tag {
            background: #e0e7ff;
            color: #4c51bf;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .search-queries {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-queries h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .query-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }

        .query-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #4b5563;
            border: 1px solid #e5e7eb;
        }

        .no-alerts {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚õΩ Gas Station & C-Store Opening Alerts</h1>
            <p class="subtitle">Real-time monitoring of new gas stations, convenience stores, and fuel centers</p>

            <div class="alert-banner">
                <h3>‚ö†Ô∏è Waiting for RSS Feeds</h3>
                <p>Your newly created Google Alerts need 24-48 hours before Google generates RSS feeds for them. The backend server is running and ready to fetch data once the RSS feeds are available. Check README.md for instructions on adding the RSS feed URLs.</p>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalAlerts">34</div>
                    <div class="stat-label">Active Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayCount">0</div>
                    <div class="stat-label">From RSS Feeds</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="backendStatus">üü¢</div>
                    <div class="stat-label">Server Status</div>
                </div>
            </div>
        </header>

        <div class="search-queries">
            <h3>üîç Monitored Search Queries</h3>
            <div class="query-grid">
                <div class="query-item">"new gas station" "opening soon"</div>
                <div class="query-item">"convenience store" "fuel pumps" "coming soon"</div>
                <div class="query-item">"travel center" "new construction"</div>
                <div class="query-item">"fuel station" "permit approved"</div>
                <div class="query-item">"service station" "new development"</div>
                <div class="query-item">"filling station" "coming soon"</div>
                <div class="query-item">"c-store" "fuel" "new location"</div>
                <div class="query-item">"truck stop" "new construction"</div>
                <div class="query-item">"gas bar" "opening"</div>
                <div class="query-item">"convenience mart" "gas pumps" "new"</div>
            </div>
        </div>

        <div class="feed-container">
            <div class="feed-header">
                <div class="feed-title">üì∞ Live Feed</div>
                <div class="live-indicator loading" id="liveIndicator">
                    <div class="pulse"></div>
                    <span id="statusText">CONNECTING</span>
                </div>
            </div>

            <div id="alertsFeed">
                <div class="no-alerts">
                    <p>Connecting to backend server...</p>
                    <p style="font-size: 0.9em; margin-top: 10px;">Fetching RSS feeds from Google Alerts...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-detect backend URL - will be replaced during deployment
        const BACKEND_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://gas-station-alerts-backend-1.onrender.com';
        const API_URL = `${BACKEND_URL}/api/feeds`;
        let alertCount = 0;
        let lastFetchTime = null;

        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        function updateLiveIndicator(status, text) {
            const indicator = document.getElementById('liveIndicator');
            const statusText = document.getElementById('statusText');

            indicator.className = 'live-indicator ' + status;
            statusText.textContent = text;

            // Update backend status emoji
            const statusEmojis = {
                '': 'üü¢',
                'loading': 'üü°',
                'error': 'üî¥'
            };
            document.getElementById('backendStatus').textContent = statusEmojis[status] || 'üü¢';
        }

        function addAlertToFeed(alert, isNew = false) {
            const feed = document.getElementById('alertsFeed');

            const noAlerts = feed.querySelector('.no-alerts');
            if (noAlerts) {
                noAlerts.remove();
            }

            const alertDiv = document.createElement('div');
            alertDiv.className = isNew ? 'alert-item new' : 'alert-item';
            alertDiv.innerHTML = `
                <div class="alert-header">
                    <div class="alert-title">
                        <a href="${alert.link}" target="_blank">${alert.title}</a>
                    </div>
                    <div class="alert-time">${formatTime(alert.pubDate)}</div>
                </div>
                <div class="alert-source">üì∞ ${alert.source}</div>
                <div class="alert-snippet">${alert.content}</div>
                <div class="alert-tags">
                    <span class="tag">Google Alert</span>
                    <span class="tag">RSS Feed</span>
                </div>
            `;

            feed.insertBefore(alertDiv, feed.firstChild);

            if (isNew) {
                setTimeout(() => {
                    alertDiv.classList.remove('new');
                }, 3000);
            }
        }

        async function fetchRSSFeeds() {
            try {
                updateLiveIndicator('loading', 'FETCHING');

                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error('Failed to fetch feeds');
                }

                const data = await response.json();

                if (data.success && data.items && data.items.length > 0) {
                    // Clear existing alerts if this is the first fetch
                    if (!lastFetchTime) {
                        document.getElementById('alertsFeed').innerHTML = '';
                    }

                    // Add new items
                    data.items.forEach(item => {
                        addAlertToFeed(item, false);
                    });

                    alertCount = data.count;
                    document.getElementById('todayCount').textContent = alertCount;
                    updateLiveIndicator('', 'LIVE');
                    lastFetchTime = new Date();
                } else {
                    // No items yet - show waiting message
                    if (!lastFetchTime) {
                        const feed = document.getElementById('alertsFeed');
                        feed.innerHTML = `
                            <div class="no-alerts">
                                <p>‚úÖ Connected to backend server</p>
                                <p style="font-size: 0.9em; margin-top: 10px;">Waiting for RSS feed URLs to be added...</p>
                                <p style="font-size: 0.85em; margin-top: 10px; color: #6b7280;">Check the README.md file in the backend folder for instructions.</p>
                            </div>
                        `;
                    }
                    updateLiveIndicator('loading', 'WAITING');
                }
            } catch (error) {
                console.error('Error fetching feeds:', error);
                updateLiveIndicator('error', 'ERROR');

                const feed = document.getElementById('alertsFeed');
                if (!lastFetchTime) {
                    feed.innerHTML = `
                        <div class="no-alerts">
                            <p>‚ùå Cannot connect to backend server</p>
                            <p style="font-size: 0.9em; margin-top: 10px;">Make sure the Node.js server is running:</p>
                            <p style="font-size: 0.85em; margin-top: 10px; color: #6b7280;">
                                cd ~/Documents/gas-station-alerts-backend<br>
                                npm start
                            </p>
                        </div>
                    `;
                }
            }
        }

        // Check server health
        async function checkHealth() {
            try {
                const response = await fetch('http://localhost:3000/api/health');
                if (response.ok) {
                    console.log('‚úÖ Backend server is healthy');
                }
            } catch (error) {
                console.error('‚ùå Backend server health check failed');
            }
        }

        // Initial fetch
        window.addEventListener('load', () => {
            checkHealth();
            fetchRSSFeeds();

            // Fetch new data every 5 minutes
            setInterval(fetchRSSFeeds, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
